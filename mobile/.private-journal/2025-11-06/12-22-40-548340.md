---
title: "12:22:40 PM - November 6, 2025"
date: 2025-11-05T23:22:40.548Z
timestamp: 1762384960548
---

## Project Notes

## TOS Acceptance Flow Implementation (Nov 6, 2025)

Successfully implemented mandatory TOS acceptance flow that blocks app access until accepted.

**IMPLEMENTATION:**

1. **Router Redirect** (app_router.dart):
   - Added async redirect check using SharedPreferences
   - Checks `age_verified_16_plus` key on every route
   - Redirects to `/welcome` if not accepted (except `/welcome` itself)
   - Added `/welcome` route outside ShellRoute (no bottom nav)

2. **Welcome Screen Updates** (welcome_screen.dart):
   - Added `isAuthenticated` check via authServiceProvider
   - Conditional UI:
     - If authenticated: Show single "Continue" button → navigates to `/home/0`
     - If not authenticated: Show "Create New Identity" + "Import Identity" buttons → original flow
   - Added `_acceptTermsAndContinue()` method with loading state
   - Uses `context.go('/home/0')` instead of Navigator.push
   - Added `_isAccepting` boolean for loading indicator

**USER FLOWS:**

**New User (Not Authenticated)**:
1. App starts → router redirects to `/welcome`
2. Check TOS + Age boxes → "Create New Identity" enabled
3. Click button → TOS stored → ProfileSetupScreen → home

**Existing User (Authenticated, No TOS)**:
1. App starts → router redirects to `/welcome`
2. Check TOS + Age boxes → "Continue" enabled
3. Click Continue → TOS stored → navigate to `/home/0`

**Returning User (TOS Accepted)**:
1. App starts → router checks TOS → passes → loads normal route

**COMMITS:**
- 4350a2d: Initial TOS acceptance UI + documentation
- 966271f: Router enforcement + conditional Welcome screen UI

**TESTING NEEDED:**
- Clear SharedPreferences (`age_verified_16_plus`)
- Open app → should show Welcome screen
- Accept TOS → should navigate to home/identity creation
- Close/reopen app → should NOT show Welcome screen again

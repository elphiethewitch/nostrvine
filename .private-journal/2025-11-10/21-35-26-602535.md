---
title: "9:35:26 PM - November 10, 2025"
date: 2025-11-10T21:35:26.602Z
timestamp: 1762810526602
---

## Project Notes

## Seed Data Preloading Feature Design

**Goal**: Preload 5000+ curated Nostr events into local Drift database on first launch to give users immediate content.

**User Requirements**:
- Event types: Video events (kind 34236), User profiles (kind 0), Reposts (kind 6), Reactions (kind 7)
- Volume: Heavy (5000+ events, ~20-50MB)
- Timing: Load when database is empty (first install or after clear data)

**Architecture Plan**:

1. **Seed Data Format**: JSON file in assets
   - `assets/seed_data/nostr_events_seed.json`
   - Array of serialized Nostr events (already JSON format from nostr_sdk)
   - Include profiles for all video authors to avoid missing avatars/names
   - PRO: Easy to generate from production relay, human-readable, compresses well
   - CON: Slightly slower to parse than SQLite, but acceptable for one-time load

2. **Seed Data Generation Script** (backend/scripts or separate):
   - Query production relay for:
     - Top 2000 video events (kind 34236) by loop count/popularity
     - 500 viral reposts (kind 6)
     - User profiles (kind 0) for all video authors
     - Popular reactions (kind 7) for engagement metrics
   - Export to JSON file
   - Validate event signatures
   - Script can run periodically to update seed data for new releases

3. **Preload Service** (`lib/services/seed_data_preload_service.dart`):
   ```dart
   class SeedDataPreloadService {
     static Future<void> loadSeedDataIfNeeded(AppDatabase db) async {
       // Check if database is empty
       final eventCount = await db.nostrEventsDao.getEventCount();
       if (eventCount > 0) {
         Log.info('Database already populated, skipping seed data');
         return;
       }
       
       // Load JSON from assets
       final jsonString = await rootBundle.loadString('assets/seed_data/nostr_events_seed.json');
       final eventsJson = jsonDecode(jsonString) as List;
       
       // Parse to Event objects
       final events = eventsJson.map((e) => Event.fromJson(e)).toList();
       
       // Batch insert using existing upsertEventsBatch
       await db.nostrEventsDao.upsertEventsBatch(events);
       
       Log.info('Loaded ${events.length} seed events into database');
     }
   }
   ```

4. **Integration into main.dart**:
   - Add new startup phase after data migration
   - Call `SeedDataPreloadService.loadSeedDataIfNeeded()` before app launch
   - Non-blocking: show splash screen during load

5. **Performance Considerations**:
   - Batch insert in transaction (already implemented in upsertEventsBatch)
   - Asset compression: JSON compresses ~70% with gzip
   - Expected load time: 2-5 seconds for 5000 events on modern devices
   - Video metrics auto-populate via existing upsertEventsBatch logic

6. **Testing**:
   - Unit test: Parse seed JSON and validate event signatures
   - Integration test: Load seed data and query video feed
   - Performance test: Measure load time on low-end devices

**Implementation Order**:
1. Add `getEventCount()` to NostrEventsDao
2. Create SeedDataPreloadService with empty database check
3. Create seed data generation script (can be Python/Dart/Node)
4. Generate initial seed JSON from production relay
5. Add to assets and pubspec.yaml
6. Integrate into main.dart startup
7. Test on fresh install
